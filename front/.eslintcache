[{"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\index.js":"1","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\App.js":"2","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\pages\\Home.js":"3","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\pages\\Profil.js":"4","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\pages\\Connexion.js":"5","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Navbar.js":"6","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Thread.js":"7","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\NewPostForm.js":"8","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Log\\Logout.js":"9","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Profil\\UpdateProfil.js":"10","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Log\\index.js":"11","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Utils.js":"12","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\Card.js":"13","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Profil\\UploadImg.js":"14","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Log\\SignInForm.js":"15","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Log\\SignUpForm.js":"16","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\DeleteCard.js":"17","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\LikeButton.js":"18","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\CardComments.js":"19","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\DeleteComment.js":"20"},{"size":320,"mtime":1712240130728,"results":"21","hashOfConfig":"22"},{"size":539,"mtime":1728641910435,"results":"23","hashOfConfig":"22"},{"size":1404,"mtime":1740695221202,"results":"24","hashOfConfig":"22"},{"size":236,"mtime":1713880511348,"results":"25","hashOfConfig":"22"},{"size":263,"mtime":1713309547387,"results":"26","hashOfConfig":"22"},{"size":1798,"mtime":1730679641090,"results":"27","hashOfConfig":"22"},{"size":1278,"mtime":1729784939577,"results":"28","hashOfConfig":"22"},{"size":4612,"mtime":1730685027684,"results":"29","hashOfConfig":"22"},{"size":460,"mtime":1728645981877,"results":"30","hashOfConfig":"22"},{"size":4368,"mtime":1730564857675,"results":"31","hashOfConfig":"22"},{"size":1109,"mtime":1728651873916,"results":"32","hashOfConfig":"22"},{"size":1076,"mtime":1728655185171,"results":"33","hashOfConfig":"22"},{"size":6783,"mtime":1740666869174,"results":"34","hashOfConfig":"22"},{"size":2392,"mtime":1730578490187,"results":"35","hashOfConfig":"22"},{"size":2892,"mtime":1728653976560,"results":"36","hashOfConfig":"22"},{"size":3161,"mtime":1740665336440,"results":"37","hashOfConfig":"22"},{"size":812,"mtime":1729786374607,"results":"38","hashOfConfig":"22"},{"size":2271,"mtime":1740671668820,"results":"39","hashOfConfig":"22"},{"size":6565,"mtime":1730763931554,"results":"40","hashOfConfig":"22"},{"size":1397,"mtime":1730740670281,"results":"41","hashOfConfig":"22"},{"filePath":"42","messages":"43","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"19atzsb",{"filePath":"44","messages":"45","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"46","messages":"47","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"48","messages":"49","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"50","messages":"51","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"52","messages":"53","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"54","messages":"55","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"56","messages":"57","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"58","messages":"59","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"60","messages":"61","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"62","messages":"63","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"64","messages":"65","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"66","messages":"67","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"68"},{"filePath":"69","messages":"70","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"71","messages":"72","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"73","messages":"74","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"75","messages":"76","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"77","messages":"78","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"79","messages":"80","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"81","messages":"82","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\index.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\App.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\pages\\Home.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\pages\\Profil.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\pages\\Connexion.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Navbar.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Thread.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\NewPostForm.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Log\\Logout.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Profil\\UpdateProfil.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Log\\index.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Utils.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\Card.js",["83"],"import React, { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { dateParser, isEmpty } from \"../Utils\";\r\nimport LikeButton from \"./LikeButton\";\r\nimport DeleteCard from \"./DeleteCard\";\r\nimport CardComments from \"./CardComments\";\r\n\r\nconst Card = ({ getPosts, post }) => {\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isUpdated, setIsUpdated] = useState(false);\r\n  const [textUpdate, setTextUpdate] = useState(null);\r\n  const [comments, setComments] = useState([]);\r\n  const [showComments, setShowComments] = useState(false);\r\n  const [usersData, setUsersData] = useState([]);\r\n  const [userData, setUserData] = useState([]);\r\n  const userId = localStorage.getItem(\"userId\");\r\n  const token = localStorage.getItem(\"token\");\r\n\r\n  const updateItem = () => {\r\n    // Envoi de la mise à jour du texte si l'état textUpdate est non null\r\n    if (textUpdate) {\r\n      console.log(\"post1\", post);\r\n\r\n      return axios({\r\n        method: \"put\",\r\n        url: `${process.env.REACT_APP_API_URL}api/post/${post.id}`,\r\n        data: { file: post.attachment, content: textUpdate },\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      })\r\n        .then((res) => {\r\n          console.log(\"res.data de updateItem :\", res.data);\r\n          setIsUpdated(false);\r\n          getPosts();\r\n        })\r\n        .catch((err) => console.log(err));\r\n    }\r\n    console.log(\"post.attachment\", post.attachment);\r\n    setIsUpdated(false);\r\n  };\r\n\r\n  // Execution de la récuperation des données utilisateurs uniquement au premier chargement de la fonction Card\r\n\r\n  const getComments = () => {\r\n    axios\r\n      .get(`${process.env.REACT_APP_API_URL}api/comment/` + post.id, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      })\r\n      .then((res) => {\r\n        setComments(res.data);\r\n      })\r\n      .catch((err) => console.log(err));\r\n  };\r\n\r\n  useEffect(() => {\r\n    const getUsersData = () => {\r\n      axios\r\n        .get(`${process.env.REACT_APP_API_URL}api/user/`, {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n        })\r\n        .then((res) => {\r\n          setUsersData(res.data);\r\n        })\r\n        .catch((err) => console.log(err));\r\n    };\r\n\r\n    const getUserData = () => {\r\n      axios\r\n        .get(`${process.env.REACT_APP_API_URL}api/user/` + userId, {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n        })\r\n        .then((res) => {\r\n          setUserData(res.data);\r\n        })\r\n        .catch((err) => console.log(err));\r\n    };\r\n\r\n    getUsersData();\r\n    getUserData();\r\n    getComments();\r\n  }, [post.id, userId, token]);\r\n\r\n  // On desactive le loader dès que les données utilisateurs sont chargées\r\n  useEffect(() => {\r\n    if (!isEmpty(usersData)) {\r\n      setIsLoading(false);\r\n    }\r\n  }, [usersData]);\r\n\r\n  console.log(\"res.usersData\", usersData);\r\n\r\n  return (\r\n    <li className=\"card-container\">\r\n      {isLoading ? (\r\n        <i className=\"fas fa-spinner fa-spin\"></i>\r\n      ) : (\r\n        <>\r\n          <div className=\"card-left\">\r\n            <img\r\n              src={\r\n                // Vérification de la présence des données pour éviter une erreur\r\n                !isEmpty(usersData[0]) &&\r\n                // Affichage de la photo utilisateur si l'id correspond à l'user_id du post sinon rien\r\n                usersData\r\n                  .map((user) => {\r\n                    if (user.id === post.user_id) return user.attachment;\r\n                    return null;\r\n                  })\r\n                  // Utilisation de join pour fixer le problème des virgules générées par map dans le rendu\r\n                  .join(\"\")\r\n              }\r\n              alt=\"poster-pic\"\r\n            />\r\n          </div>\r\n          <div className=\"card-right\">\r\n            <div className=\"card-header\">\r\n              <div className=\"pseudo\">\r\n                <h3>\r\n                  {!isEmpty(usersData[0]) &&\r\n                    usersData\r\n                      .map((user) => {\r\n                        if (user.id === post.user_id) return user.username;\r\n                        else return null;\r\n                      })\r\n                      .join(\"\")}\r\n                </h3>\r\n              </div>\r\n              {/* Affichage et formatage de la date */}\r\n              <span>{dateParser(post.created_at)}</span>\r\n            </div>\r\n            {isUpdated === false && <p>{post.content}</p>}\r\n            {isUpdated && (\r\n              <div className=\"update-post\">\r\n                <textarea\r\n                  defaultValue={post.content}\r\n                  onChange={(e) => setTextUpdate(e.target.value)}\r\n                />\r\n                <div className=\"button-valide\">\r\n                  <button className=\"btn\" onClick={updateItem}>\r\n                    Valider\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}{\" \"}\r\n            {post.attachment && (\r\n              <img src={post.attachment} alt=\"card-pic\" className=\"card-pic\" />\r\n            )}\r\n            {post.video && (\r\n              <iframe\r\n                width=\"500\"\r\n                height=\"300\"\r\n                src={post.video}\r\n                frameBorder=\"0\"\r\n                allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\r\n                allowFullScreen\r\n                title={post._id}\r\n              ></iframe>\r\n            )}\r\n            {/* Implémentation des droits admin ou user pour la suppression d'un post*/}\r\n            {userData.id === post.user_id ? (\r\n              <div className=\"button-container\">\r\n                <div onClick={() => setIsUpdated(!isUpdated)}>\r\n                  <img src=\"./img/edit.svg\" alt=\"edit\" />\r\n                </div>\r\n                <DeleteCard post={post} getPosts={getPosts} />\r\n              </div>\r\n            ) : (\r\n              userData.is_admin && (\r\n                <div className=\"button-container\">\r\n                  <DeleteCard post={post} getPosts={getPosts} />\r\n                </div>\r\n              )\r\n            )}\r\n            <div className=\"card-footer\">\r\n              <div className=\"comment-icon\">\r\n                <img\r\n                  onClick={() => setShowComments(!showComments)}\r\n                  src=\"./img/comment.jpg\"\r\n                  alt=\"comment\"\r\n                />\r\n                <span>{comments.length}</span>\r\n              </div>\r\n              <LikeButton post={post} />\r\n            </div>\r\n            {showComments && (\r\n              <CardComments postId={post.id} getComments={getComments} />\r\n            )}\r\n          </div>\r\n        </>\r\n      )}\r\n    </li>\r\n  );\r\n};\r\n\r\nexport default Card;\r\n","D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Profil\\UploadImg.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Log\\SignInForm.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Log\\SignUpForm.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\DeleteCard.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\LikeButton.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\CardComments.js",[],"D:\\Temp\\Site web\\FabienD_7_01032024\\front\\src\\components\\Post\\DeleteComment.js",[],{"ruleId":"84","severity":1,"message":"85","line":88,"column":6,"nodeType":"86","endLine":88,"endColumn":30,"suggestions":"87"},"react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'getComments'. Either include it or remove the dependency array.","ArrayExpression",["88"],{"desc":"89","fix":"90"},"Update the dependencies array to be: [post.id, userId, token, getComments]",{"range":"91","text":"92"},[2677,2701],"[post.id, userId, token, getComments]"]